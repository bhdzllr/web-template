/**
 * ********** Form **********
 * Inputs: Always set border radius (even if it is 0), `-webkit-appearance: none;` and `box-sizing: border-box;` for consistency (iOS)
 */

button,
input,
optgroup,
select,
textarea {
	color: inherit;
	font-family: inherit;
	font-size: inherit;
	line-height: inherit;
}

[type="checkbox"],
[type="radio"],
[type="range"],
progress {
	accent-color: var(--color-primary);
}

[type="checkbox"],
[type="radio"] {
	vertical-align: baseline;

	& + label {
		display: inline;
		vertical-align: baseline;
	}
}

[type="search"] {
	-webkit-appearance: none; /* Remove rounded design on iOS */
}

[type="date"],
[type="month"],
[type="time"],
[type="datetime-local"] {
	-webkit-appearance: none; /* Make it look like a normal text input, not like the default system (e. g. iOS) dropdown. */
}

[type="date"],
[type="month"],
[type="week"],
[type="time"],
[type="datetime-local"],
[type="color"] {
	min-block-size: 46px; /* iOS needs height if there is no default value. */
}

input::-webkit-date-and-time-value {
	   text-align: start; /* Align input value on start side of field for iOS */
}

textarea {
	resize: vertical;
}

textarea:not([rows]) {
  min-block-size: 10em;
}

[type="search"] {
	-webkit-appearance: textfield;
	outline-offset: -2px;
}

::file-upload-button {
	-webkit-appearance: button;
	font: inherit;
}

::-webkit-file-upload-button {
	-webkit-appearance: button;
	font: inherit;
}

::-webkit-inner-spin-button,
::-webkit-outer-spin-button {
	min-block-size: auto;
}

::-webkit-search-decoration {
	-webkit-appearance: none;
}

.form {
	margin: 0 auto;

	& > :last-child {
		margin-block-end: 0;
	}

	& fieldset {
		margin: 0 0 1em;
		padding: 0;

		border: none;
		border-radius: 0.15em;

		&.fieldset-visible {
			padding: 1em;

			border: 1px solid var(--color-text-lighter);
		}

		& > :last-child {
			margin-block-end: 0;
		}
	}

	& label {
		display: block;
		padding-block-end: 0.15em;

		line-height: 1.35;
	}

	/* Input */
	& input:not([type="submit"]):not([type="button"]):not([type="reset"]):not([type="checkbox"]):not([type="radio"]):not([type="range"]),
	& textarea,
	& select {
		padding: 0.75em 0.65em;
		box-sizing: border-box;

		background-color: var(--color-neutral);
		border: 1px solid var(--color-mono-40);
		box-shadow: inset 0 1px 3px var(--color-mono-10);
		border-radius: 0.15em;
		-webkit-appearance: none; /* Remove shadow in iOS */

		line-height: 1.3;
	}

	/* Input Outline */
	& input:not([type="submit"]):not([type="button"]):not([type="reset"]):not([type="checkbox"]):not([type="radio"]):not([type="range"]):focus,
	& textarea:focus,
	& select:focus,
	& [type="checkbox"]:focus + label::before,
	& [type="radio"]:focus + label::before {
		border-color: var(--color-primary);
		box-shadow: 0 0 0 0.2em var(--color-primary-lighter);
		outline: none;
	}

	/* Input Disabled */
	& input:not([type="submit"]):not([type="button"]):not([type="reset"]):not([type="checkbox"]):not([type="radio"]):not([type="range"]):disabled,
	& textarea:disabled,
	& select:disabled,
	& [type="checkbox"]:disabled + label::before,
	& [type="radio"]:disabled + label::before {
		background-color: var(--color-mono-5);
		cursor: not-allowed;
	}

	& select {
		min-inline-size: 3em;
		padding-inline-end: 1.75em;

		-webkit-appearance: none; /* Remove shadow, without styling select looks like regular input (no arrow) */
		/* background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3E%3Cpath d='M0 0l4 4 4-4h-8z' transform='translate(0 2)' fill='%23333333' /%3E%3C/svg%3E"); */
		background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3E%3Cpath d='M1.5 0l-1.5 1.5 4 4 4-4-1.5-1.5-2.5 2.5-2.5-2.5z' transform='translate(0 1)' fill='%23333333' /%3E%3C/svg%3E");
		background-position: calc(100% - 10px) center;
		background-repeat: no-repeat;
		background-attachment: scroll;
		background-size: 0.625em;
		box-shadow: none;
		border-block-end-width: 2px;

		&[multiple] {
			background-image: none;
		}

		&::-ms-expand {
			display: none;
		}

		&:-moz-focusring {
			color: transparent;
			text-shadow: 0 0 0 var(--color-text);
		}

		& option:not(:checked) {
			color: var(--color-text);
		}
	}

	& [type="checkbox"],
	& [type="radio"] {
		position: absolute;

		inline-size: 0.1px;
		block-size: 0.1px;

		appearance: none;
		opacity: 0.00001;

		& + label {
			position: relative;

			margin-inline-start: 1.5em;

			cursor: pointer;
		}

		& + label::before,
		&:checked + label::after {
			position: absolute;
			inset-block-start: 50%;
			inset-inline-end: -1.5em;

			content: '';
			display: inline-block;
			inline-size: 1em;
			block-size: 1em;

			border: 1px solid var(--color-text-lighter);
			box-shadow: inset 1px 1px 1px var(--color-mono-10);
			transform: translateY(-50%);

			line-height: 1.1;
			text-align: center;
		}

		&:checked + label::after {
			background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3E%3Cpath d='M6.41 0l-.69.72-2.78 2.78-.81-.78-.72-.72-1.41 1.41.72.72 1.5 1.5.69.72.72-.72 3.5-3.5.72-.72-1.44-1.41z' transform='translate(0 1)' fill='%23333333' /%3E%3C/svg%3E");
			background-position: center center;
			background-repeat: no-repeat;
			background-size: 75%;
			border-color: transparent;
			box-shadow: none;
		}

		&:focus + label::before {
			/* Defined above */
		}

		&:disabled + label::before {
			/* Defined above */
		}
	}

	& [type="radio"] {
		& + label::before,
		&:checked + label::after {
			border-radius: 50%;
		}

		&:checked + label::after {
			background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3E%3Ccircle r='3' fill='%23333333' /%3E%3C/svg%3E");
			background-size: 50%;
		}
	}

	& [type="file"] {
		/* Button defined in button.css */

		cursor: pointer;
	}

	& [type="range"] {
		margin: 0;
		padding: 0;

		-webkit-appearance: none;
		appearance: none;
		background: transparent;

		--slider-track-block-size: 0.5em;
		--slider-thumb-size: 1em;
		--slider-track-border-radius: 0.15em;
		--slider-color-track: var(--color-mono-30);
		--slider-color-track-disabled: var(--color-mono-10);
		--slider-color-thumb-background: var(--color-neutral);
		--slider-color-thumb-border: var(--color-mono-40);

		/* Combining vendor pseudo elements does not work, we need to keep the following rules separated */

		&:focus,
		&:active {
			outline: none;

			&::-webkit-slider-thumb {
				/* Input Outline */
				border-color: var(--color-primary);
				box-shadow: 0 0 0 0.2em var(--color-primary-lighter);
				outline: none;
			}

			&::-moz-range-thumb {
				/* Input Outline */
				border-color: var(--color-primary);
				box-shadow: 0 0 0 0.2em var(--color-primary-lighter);
				outline: none;
			}

			&::-ms-thumb {
				/* Input Outline */
				border-color: var(--color-primary);
				box-shadow: 0 0 0 0.2em var(--color-primary-lighter);
				outline: none;
			}
		}

		&::-moz-focus-outer {
			border: 0;
		}

		&::-webkit-slider-thumb {
			/* Slider Thumb */
			inline-size: var(--slider-thumb-size);
			block-size: var(--slider-thumb-size);
			margin-block-start: calc(var(--slider-track-block-size) - var(--slider-thumb-size) / 2);

			appearance: none;
			-webkit-appearance: none;
			background: var(--slider-color-thumb-background);
			border: 1px solid var(--slider-color-thumb-border);
			border-radius: 50%;
		}

		&::-moz-range-thumb {
			/* Slider Thumb */
			inline-size: var(--slider-thumb-size);
			block-size: var(--slider-thumb-size);
			margin-block-start: calc(var(--slider-track-block-size) - var(--slider-thumb-size) / 2);

			appearance: none;
			-webkit-appearance: none;
			background: var(--slider-color-thumb-background);
			border: 1px solid var(--slider-color-thumb-border);
			border-radius: 50%;
		}

		&::-ms-thumb {
			/* Slider Thumb */
			inline-size: var(--slider-thumb-size);
			block-size: var(--slider-thumb-size);
			margin-block-start: calc(var(--slider-track-block-size) - var(--slider-thumb-size) / 2);

			appearance: none;
			-webkit-appearance: none;
			background: var(--slider-color-thumb-background);
			border: 1px solid var(--slider-color-thumb-border);
			border-radius: 50%;

			margin-block-start: 0;
			margin-inline-start: 0.15em;
			margin-inline-end: 0.15em;
		}

		&::-webkit-slider-runnable-track {
			/* Slider Track */
			inline-size: 100%;
			block-size: var(--slider-track-block-size);

			appearance: none;
			-webkit-appearance: none;
			background: var(--slider-color-track);
			border-radius: var(--slider-track-border-radius);
			border-color: transparent;
			cursor: pointer;
		}

		&::-moz-range-track {
			/* Slider Track */
			inline-size: 100%;
			block-size: var(--slider-track-block-size);

			appearance: none;
			-webkit-appearance: none;
			background: var(--slider-color-track);
			border-radius: var(--slider-track-border-radius);
			border-color: transparent;
			cursor: pointer;
		}

		&::-ms-track {
			/* Slider Track */
			inline-size: 100%;
			block-size: var(--slider-track-block-size);

			appearance: none;
			-webkit-appearance: none;
			background: var(--slider-color-track);
			border-radius: var(--slider-track-border-radius);
			border-color: transparent;
			cursor: pointer;

			background-color: transparent;
			border-width: 0.5em;
			border-color: transparent;

			color: transparent;
		}

		&::-ms-fill-lower {
			background: var(--slider-color-track);
			border-radius: var(--slider-track-border-radiu);
		}

		&::-ms-fill-upper {
			background: var(--slider-color-track);
			border-radius: var(--slider-track-border-radiu);
		}

		&:disabled {
			&::-webkit-slider-thumb {
				background: var(--slider-color-track-disabled);
			}

			&::-moz-range-thumb {
				background: var(--slider-color-track-disabled);
			}

			&::-ms-thumb {
				background: var(--slider-color-track-disabled);
			}

			&::-webkit-slider-runnable-track {
				cursor: default;
			}

			&::-moz-range-track {
				cursor: default;
			}
		}
	}

	&.form--validated {
		& input:not([type="submit"]):not([type="button"]):not([type="reset"]):not([type="range"]),
		& textarea,
		& select {
			&:invalid {
				border: 2px solid var(--color-negative);

				&:focus {
					border-color: var(--color-negative);
					box-shadow: 0 0 0 0.2em var(--color-negative-background);
				}
			}

			&:valid + .form__assistive--invalid {
				display: none;
			}
		}

		& .form__assistive--invalid {
			display: block;
		}
	}

	&.form--disabled {
		position: relative;

		&::after {
			position: absolute;
			inset-block-start: 0;

			display: block;
			inline-size: 100%;
			block-size: 100%;
			content: '';

			background-color: rgba(255, 255, 255, 0.45);
			cursor: not-allowed;
		}
	}

	& [type="submit"] {
		margin: 0.5em 0;

		&:focus {
			@include form-outline;
		}	
	}
}

.form-controls-expanded {
	& input:not([type="submit"]):not([type="button"]):not([type="reset"]):not([type="checkbox"]):not([type="radio"]),
	& textarea,
	& select {
		inline-size: 100%;
	}
}

.form-assistive {
	display: block;
	padding-block-end: 0.15em;

	font-size: 0.8em;
	color: var(--color-text-lighter);
	line-height: 1.25;
}

.form-assistive--invalid {
	display: block;
	margin: 0;
	padding-block-start: 0.25em;

	color: var(--color-negative);
	font-size: 1em;
	font-weight: bold;
}
